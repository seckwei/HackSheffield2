<html>
    <head>
        <title>Lazy Web Devs</title>
        <style>
            * {
                font-family: sans-serif;
                margin: 0px;
            }
            .container, .sidebar, .content {
                height: 99vh;
            }
            .container {
                width: 100%;
            }
            .sidebar {
                width: 20%;
                padding-top: 40px;
                background-color: #eee;
            }
            .content {
                width: 79%;
            }

            td {
                vertical-align: top;
            }

        </style>
        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"   integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc="   crossorigin="anonymous"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            'use strict';
            let protocol = 'https',
                host = window.location.host,
                url = `${protocol}://${host}`;

            console.log(url);
            let socket = io.connect(url);

            function createElement(data){
                let element = $(`<${data.element}>`);
                element.attr('id', (data.id));
                element.css({
                    'width': data.width,
                    'height': data.height,
                    'background-color': data.bg
                });
                return element;
            }

            const DEST = '.content';

            socket.on('message', (data) => {
                console.log(data);

                switch(data.action){
                    case 'create': {
                        if(data.parent && data.children){
                            let parent = createElement(data.parent),
                                child;
                            $(DEST).append(parent);
                            //parent.text(data.parent.content || new Date().getTime());

                            for(let i = 0; i < data.children.amount; i++){
                                child = createElement(data.children.child);
                                parent.append(child);
                                child.text(data.children.child.content || new Date().getTime());
                            }
                        }
                        else {
                            let element = createElement(data);
                            $(DEST).append(element);     
                            element.text(data.content);
                        }
                        break;
                    }
                    case 'edit': {
                        let element = $(`#${data.id}`);
                        element.css({
                            'height': data.height || element.height(),
                            'width': data.width || element.width()
                        });
                        break;
                    }
                    case 'delete': {
                        $(`#${data.id}`).remove();
                        break;
                    }
                }
                
                let arrID = $.map($(DEST).children(), (elem) => {
                    return elem.getAttribute('id');
                });
                $('.sidebar').empty();
                let list = $('<ul>');
                arrID.forEach((id) => {
                    list.append($(`<li>${id}</li>`));
                });
                $('.sidebar').append(list);
            });
        </script>
    </head>
    <body>
        <table class="container">
            <tr>
                <td class="sidebar"></td>
                <td class="content"></td>
            </tr>
        </table>
    </body>
</html>
